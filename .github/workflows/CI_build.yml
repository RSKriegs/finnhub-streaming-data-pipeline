#Optional TODO: implement more sophisticated CI pipeline including K8s & Terraform
name: CI_build

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: setup-minikube
      uses: medyagh/setup-minikube@v0.0.11
      with:
          driver: docker
          container-runtime: docker
          cpus: 2
          memory: 4096
    - name: Setup docker compose
      uses: yu-ichiro/spin-up-docker-compose-action@v1
      with:
          file: docker-compose-ci.yaml
    - name: terraform-apply
      uses: dflook/terraform-apply@v1.29.1
      with:
          path: terraform-k8s
          auto_approve: true

